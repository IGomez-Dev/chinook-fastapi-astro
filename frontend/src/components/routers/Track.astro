---
export interface Track {
  TrackId: number;
  Name: string;
  AlbumId: number;
  MediaTypeId: number;
  GenreId: number;
  Composer: string | null; 
  Milliseconds: number;
  Bytes: number;
  UnitPrice: number;
}

const res = await fetch("http://127.0.0.1:8000/tracks/");
const items: Track[] = await res.json();

const formatDuration = (ms: number): string => {
  const totalSeconds = Math.floor(ms / 1000);
  const minutes = Math.floor(totalSeconds / 60);
  const seconds = totalSeconds % 60;
  const paddedSeconds = seconds.toString().padStart(2, '0');
  return `${minutes}:${paddedSeconds}`;
};

const formatBytes = (bytes: number): string => {
  if (bytes < 1024) return `${bytes} B`;
  return `${(bytes / 1024 / 1024).toFixed(2)} MB`; 
};
---

<h2 class="text-white text-3xl font-bold text-center my-6">
  Catálogo de Pistas de Música
</h2>

<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
  {items.map((item) => (
    <div 
      class="border border-gray-600 rounded-lg p-6 shadow hover:shadow-lg hover:scale-105 transition transform duration-200 text-left bg-slate-900/60 backdrop-blur-sm my-4 flex flex-col justify-between"
    >
      <div>
        <div class="flex justify-between items-start mb-3">
          <h4 class="text-xs text-gray-500">ID (PK): {item.TrackId}</h4>
          <p class="text-xl text-green-400 font-bold">
            ${item.UnitPrice.toFixed(2)}
          </p>
        </div>
        
        <h3 class="text-xl text-white font-semibold mb-4 border-b border-gray-700 pb-2">
          {item.Name}
        </h3>
        
        <p class="text-sm text-gray-300">
          <span class="font-semibold">Compositor:</span> {item.Composer ?? 'N/A'}
        </p> 
        <p class="text-sm text-gray-300">
          <span class="font-semibold">Duración:</span> {formatDuration(item.Milliseconds)}
        </p>
        <p class="text-sm text-gray-300">
          <span class="font-semibold">Tamaño:</span> {formatBytes(item.Bytes)}
        </p>
      </div>

      <div class="mt-4 pt-3 border-t border-gray-800 text-xs text-gray-400 space-y-1">
        <p>Album ID: {item.AlbumId}</p>
        <p>Media Type ID: {item.MediaTypeId}</p>
        <p>Genre ID: {item.GenreId}</p>
      </div>
    </div>
  ))}
</div>